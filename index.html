<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, user-scalable=no" />
  <title>XGP ë¯¸ë‹ˆê²Œì„ (ì—…ê·¸ë ˆì´ë“œ/ìµœì í™”/í¬ìŠ¤í„° ì‹œì‘í™”ë©´)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root{
      --txt:#fff6e6;
      --muted:#ffd9a6;
      --line:#ffb347;

      --panel: rgba(20,12,40,.55);
      --accent:#7df9ff;
      --warn:#ffd166;
      --danger:#ff4d4d;

      --uiShadow: 0 12px 40px rgba(0,0,0,.35);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family:"Press Start 2P", system-ui, sans-serif;
      color:var(--txt);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;

      background:
        radial-gradient( circle at 15% 20%, rgba(255,255,255,.18), transparent 35% ),
        radial-gradient( circle at 85% 35%, rgba(255,120,60,.20), transparent 42% ),
        radial-gradient( circle at 20% 85%, rgba(0,255,255,.08), transparent 45% ),
        linear-gradient( 135deg, #1a1f4a 0%, #1b1f3a 22%, #2d1557 48%, #b31217 100% );
    }

    .posterGrid{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.24;
      mix-blend-mode:screen;
      background:
        linear-gradient(to right, rgba(255,255,255,.09) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.07) 1px, transparent 1px);
      background-size: 64px 64px;
      transform: perspective(900px) rotateX(7deg);
      filter: blur(.2px);
    }
    .grain{
      position:fixed; inset:-40%;
      pointer-events:none;
      opacity:.09;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      animation: grainMove 6s steps(8) infinite;
      mix-blend-mode: overlay;
    }
    @keyframes grainMove{
      0%{ transform: translate(0,0) rotate(0deg); }
      25%{ transform: translate(-2%,1%) rotate(1deg); }
      50%{ transform: translate(2%,-1%) rotate(-1deg); }
      75%{ transform: translate(-1%,-2%) rotate(1deg); }
      100%{ transform: translate(0,0) rotate(0deg); }
    }

    .wrap{ width:100%; max-width:560px; }

    .title{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-bottom:12px;
      text-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .title h1{ font-size:14px; margin:0; letter-spacing:1px; }
    .title .mini{ font-size:9px; color:var(--muted); }

    .card{
      background:
        radial-gradient(circle at 20% 10%, rgba(255,255,255,.10), transparent 40%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:2px solid var(--line);
      border-radius:16px;
      padding:14px;
      box-shadow: var(--uiShadow);
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(2px);
    }

    .hud{
      display:flex;
      gap:10px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .pill{
      flex:1;
      min-width:150px;
      background: var(--panel);
      border:2px solid rgba(255,180,90,.85);
      border-radius:12px;
      padding:10px 10px;
      font-size:10px;
      color:var(--muted);
      box-shadow: inset 0 0 22px rgba(255,160,60,.10);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .pill b{ color:var(--txt); }

    .game{
      position:relative;
      width:100%;
      aspect-ratio: 3 / 4;
      max-height: 80vh;
      overflow:hidden;
      border:2px solid var(--line);
      border-radius:14px;
      background:
        radial-gradient(circle at 40% 25%, rgba(125,249,255,.10), transparent 45%),
        radial-gradient(circle at 75% 70%, rgba(255,120,60,.12), transparent 40%),
        linear-gradient(180deg, #0b0e22 0%, #070812 100%);
      box-shadow:
        inset 0 0 60px rgba(255,120,40,0.12),
        0 16px 36px rgba(0,0,0,.35);
      touch-action:none;
      contain: layout paint size;
    }

    .spaceLayer{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:1;
      z-index:0;
    }
    .spaceLayer::before,
    .spaceLayer::after{
      content:"";
      position:absolute; inset:-20%;
      background-image:
        radial-gradient(#ffffffcc 1px, transparent 1px),
        radial-gradient(#ffffff88 1px, transparent 1px),
        radial-gradient(#ffffff55 1px, transparent 1px),
        radial-gradient(rgba(125,249,255,.55) 1px, transparent 1px);
      background-size: 110px 110px, 170px 170px, 240px 240px, 320px 320px;
      background-position: 0 0, 40px 70px, 90px 10px, 120px 150px;
      filter: drop-shadow(0 0 6px rgba(125,249,255,.16));
      transform: rotate(6deg);
      animation: starDrift 8.5s linear infinite;
      opacity:.85;
    }
    .spaceLayer::after{
      opacity:.55;
      filter: drop-shadow(0 0 8px rgba(255,170,60,.14));
      animation-duration: 5.8s;
      animation-direction: reverse;
      transform: rotate(-4deg);
    }
    @keyframes starDrift{
      from{ transform: translateY(0) translateX(0) rotate(6deg); }
      to{ transform: translateY(240px) translateX(-40px) rotate(6deg); }
    }

    .streak{
      position:absolute;
      width:220px; height:2px;
      background: linear-gradient(to right, transparent, rgba(255,255,255,.9), transparent);
      filter: drop-shadow(0 0 10px rgba(125,249,255,.35));
      transform: rotate(18deg);
      opacity:0;
      pointer-events:none;
      animation: streak 2.8s linear infinite;
      z-index:0;
    }
    .streak.s2{ animation-delay: .9s; top:35%; left:-40%; }
    .streak.s1{ top:18%; left:-60%; }
    @keyframes streak{
      0%{ transform: translateX(0) rotate(18deg); opacity:0; }
      10%{ opacity:.55; }
      35%{ opacity:.9; }
      60%{ opacity:.55; }
      100%{ transform: translateX(160vw) rotate(18deg); opacity:0; }
    }

    /* ===== í”Œë ˆì´ì–´(ì œíŠ¸ê¸°) ===== */
    .player{
      position:absolute;
      width:56px;
      height:56px;
      z-index:5;
      will-change: transform;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.35));
      transform: translate3d(0,0,0) rotate(0deg);
    }
    .jetSprite{
      width:100%;
      height:100%;
      background-repeat:no-repeat;
      background-position:center;
      background-size:contain;
      image-rendering:auto;
      filter: var(--jetFilter, none);
      transition: filter 260ms ease;
    }
    .player::before{
      content:"";
      position:absolute;
      left:50%;
      bottom:-6px;
      width:8px;
      height:12px;
      transform: translateX(-50%);
      background:
        radial-gradient(circle at 50% 8%, rgba(255,255,255,.55) 0 20%, transparent 21%),
        radial-gradient(circle at 50% 42%, rgba(255,209,102,.92) 0 52%, transparent 53%),
        radial-gradient(circle at 50% 78%, rgba(255,106,61,.92) 0 78%, transparent 79%);
      filter:
        drop-shadow(0 0 7px rgba(255,170,60,.45))
        drop-shadow(0 0 10px rgba(255,120,40,.18));
      border-radius: 999px;
      opacity:.85;
      animation: flameFlicker .11s infinite alternate;
      pointer-events:none;
    }
    @keyframes flameFlicker{
      from{ transform: translateX(-50%) scaleY(.92) scaleX(.98) translateY(0); opacity:.72; }
      to  { transform: translateX(-50%) scaleY(1.12) scaleX(1.02) translateY(1px); opacity:.92; }
    }

    /* ===== ì˜¤ë¸Œì íŠ¸ ì´ë™: CSS ë³€ìˆ˜ë¡œë§Œ translate ===== */
    .hazard, .star{
      position:absolute;
      pointer-events:none;
      z-index:3;
      will-change: transform;
      opacity:1;
      transform: translate3d(var(--x, 0px), var(--y, 0px), 0);
    }

    .hazard{
      width:36px; height:36px;
      border-radius:50%;
      background-size:contain;
      background-repeat:no-repeat;
      background-position:center;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.45)) drop-shadow(0 0 14px rgba(140,90,255,.35));
      animation: hazardWiggle .55s ease-in-out infinite;
    }
    @keyframes hazardWiggle{
      0%,100%{ transform: translate3d(var(--x,0px), var(--y,0px), 0) rotate(-2deg) scale(1); }
      50%     { transform: translate3d(var(--x,0px), var(--y,0px), 0) rotate( 2deg) scale(1.03); }
    }

    .star{
      width:28px; height:28px;
      background-size:contain;
      background-repeat:no-repeat;
      background-position:center;
      filter: drop-shadow(0 0 12px rgba(255,210,90,.45));
      animation: starPulse .75s ease-in-out infinite;
    }
    @keyframes starPulse{
      0%,100%{ transform: translate3d(var(--x,0px), var(--y,0px), 0) scale(1); }
      50%     { transform: translate3d(var(--x,0px), var(--y,0px), 0) scale(1.12); }
    }

    .explosion{
      position:absolute;
      width:120px;
      height:120px;
      transform: translate(-50%, -50%);
      pointer-events:none;
      border-radius:999px;
      opacity:0;
      filter: drop-shadow(0 0 18px rgba(255,160,60,.65));
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cdefs%3E%3CradialGradient id='a' cx='50%25' cy='50%25' r='60%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff'/%3E%3Cstop offset='28%25' stop-color='%23fff1a8'/%3E%3Cstop offset='55%25' stop-color='%23ffd166'/%3E%3Cstop offset='78%25' stop-color='%23ff6a3d'/%3E%3Cstop offset='100%25' stop-color='%23d11f2f'/%3E%3C/radialGradient%3E%3C/defs%3E%3Cpath d='M80 8l10 22 18-16 2 24 22-10-10 22 24 2-16 18 22 10-22 10 16 18-24 2 10 22-22-10-2 24-18-16-10 22-10-22-18 16-2-24-22 10 10-22-24-2 16-18-22-10 22-10-16-18 24-2-10-22 22 10 2-24 18 16z' fill='url(%23a)'/%3E%3Ccircle cx='80' cy='80' r='28' fill='%23ffffff' fill-opacity='.35'/%3E%3C/svg%3E");
      background-size:contain;
      background-repeat:no-repeat;
      background-position:center;
      animation: boom .42s ease-out forwards;
      z-index:10;
    }
    @keyframes boom{
      0%{ transform: translate(-50%, -50%) scale(.35); opacity:0; }
      15%{ opacity:1; }
      65%{ transform: translate(-50%, -50%) scale(1.85); opacity:1; }
      100%{ transform: translate(-50%, -50%) scale(2.5); opacity:0; }
    }

    .shake{ animation: shake .18s linear 3; }
    @keyframes shake{
      0%{ transform: translate(0,0); }
      25%{ transform: translate(3px, -2px); }
      50%{ transform: translate(-3px, 2px); }
      75%{ transform: translate(2px, 2px); }
      100%{ transform: translate(0,0); }
    }

    .btnRow{ display:flex; gap:10px; margin-top:12px; }
    button{
      flex:1;
      border:2px solid var(--line);
      background: var(--panel);
      color: var(--txt);
      font-family: inherit;
      padding:12px 10px;
      border-radius:12px;
      font-size:10px;
      cursor:pointer;
      box-shadow: inset 0 0 20px rgba(255,170,60,.10);
    }
    button:active{ transform: translateY(1px); }
    .primary{ border-color: var(--accent); }

    .help{
      margin-top:10px;
      color:var(--muted);
      font-size:9px;
      line-height:1.55;
      opacity:.95;
    }

    /* ===== ì‹œì‘/ì˜¤ë²„ë ˆì´(í¬ìŠ¤í„° ê°•í™”) ===== */
    .overlay{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0;
      z-index: 30;
      overflow:hidden;
    }

    .startBg{
      position:absolute; inset:0;
      background-position:center;
      background-size:cover;
      background-repeat:no-repeat;
      transform: scale(1.02);
      animation: startPan 6.5s ease-in-out infinite alternate;
      filter: saturate(1.1) contrast(1.05);
    }
    @keyframes startPan{
      from{ transform: scale(1.04) translate3d(-8px,-6px,0); }
      to  { transform: scale(1.08) translate3d(10px,8px,0); }
    }

    /* ìŠ¤ìº”ë¼ì¸ */
    .scanlines{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.28;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255,255,255,.06) 0px,
          rgba(255,255,255,.06) 1px,
          rgba(0,0,0,0) 3px,
          rgba(0,0,0,0) 6px
        );
      mix-blend-mode: overlay;
      animation: scanMove 2.2s linear infinite;
    }
    @keyframes scanMove{
      from{ transform: translateY(0); }
      to  { transform: translateY(24px); }
    }

    /* ë°œê´‘/ë¹„ë„¤íŒ… */
    .startVignette{
      position:absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(circle at 50% 40%, rgba(0,0,0,0) 32%, rgba(0,0,0,.55) 82%),
        linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.62));
    }

    /* ì‹œì‘ íŒŒí‹°í´(ê°€ë²¼ìš´ CSS íŒŒí‹°í´) */
    .startParticles{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.75;
      filter: drop-shadow(0 0 10px rgba(125,249,255,.18));
    }
    .sp{
      position:absolute;
      width:3px; height:3px;
      border-radius:999px;
      background: rgba(255,255,255,.85);
      opacity:.0;
      animation: spFly 2.6s linear infinite;
    }
    .sp.a{ background: rgba(125,249,255,.9); }
    .sp.b{ background: rgba(255,209,102,.9); }
    @keyframes spFly{
      0%{ transform: translate3d(var(--sx), calc(var(--sy) + 40px), 0) scale(.8); opacity:0; }
      15%{ opacity:.9; }
      100%{ transform: translate3d(calc(var(--sx) + var(--dx)), calc(var(--sy) - 140px), 0) scale(1.2); opacity:0; }
    }

    .startUI{
      position:absolute;
      left:0; right:0; bottom:0;
      padding:18px 16px calc(16px + env(safe-area-inset-bottom));
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.70));
    }

    /* PRESS START ë„¤ì˜¨ */
    .pressStart{
      font-size:14px;
      letter-spacing:1px;
      color: #eaffff;
      text-shadow:
        0 0 10px rgba(125,249,255,.55),
        0 0 22px rgba(125,249,255,.35),
        0 10px 35px rgba(0,0,0,.55);
      animation: neonPulse 1.1s ease-in-out infinite;
      user-select:none;
    }
    @keyframes neonPulse{
      0%,100%{ transform: translateY(0); filter: brightness(1); opacity:1; }
      50%{ transform: translateY(-2px); filter: brightness(1.15); opacity:.92; }
    }

    .startHint{
      font-size:9px;
      color:var(--muted);
      text-shadow: 2px 2px 0 rgba(0,0,0,.45);
      line-height:1.6;
      text-align:center;
      opacity:.98;
    }

    .pop{
      position:absolute;
      font-size:10px;
      color: var(--warn);
      text-shadow: 2px 2px 0 rgba(0,0,0,.45);
      animation: pop 700ms ease-out forwards;
      pointer-events:none;
      z-index: 10;
      will-change: transform, opacity;
    }
    @keyframes pop{
      from{ transform: translateY(0); opacity:1; }
      to{ transform: translateY(-18px); opacity:0; }
    }

    .touchHint{
      position:absolute;
      left:0; top:0;
      transform: translate(-50%, 0);
      pointer-events:none;
      display:none;
      text-align:center;
      z-index:6;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
    }
    .touchHint .hintHand{ font-size:18px; animation: hintBob .9s ease-in-out infinite; }
    .touchHint .hintArrow{ font-size:14px; opacity:.9; animation: hintBob 1.1s ease-in-out infinite; }
    .touchHint .hintText{
      margin-top:4px;
      font-size:8px;
      color: var(--warn);
      text-shadow: 2px 2px 0 rgba(0,0,0,.45);
    }
    @keyframes hintBob{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(6px); }
    }

    @media (max-width: 600px){
      body{
        padding:0 !important;
        overflow:auto;
        -webkit-overflow-scrolling:touch;
        display:block;
      }
      .card{
        padding:10px;
        padding-bottom: calc(10px + env(safe-area-inset-bottom));
        display:flex;
        flex-direction:column;
        gap:10px;
      }
      .game{
        aspect-ratio:auto;
        height:calc(100vh - 140px);
        max-height:none;
      }
      .help{ display:none; }
    }
  </style>
</head>

<body>
  <div class="posterGrid"></div>
  <div class="grain"></div>

  <div class="wrap">
    <div class="title">
      <h1>XGP ì±„êµ´ê²Œì„</h1>
      <div class="mini">A / D ë˜ëŠ” ë“œë˜ê·¸</div>
    </div>

    <div class="card">
      <div class="hud">
        <div class="pill">ì‹œê°„: <b id="time">0.0</b>s</div>
        <div class="pill">ë³„ ì ìˆ˜: <b id="score">0</b></div>
        <div class="pill">ì—…ê·¸ë ˆì´ë“œ: <b id="level">0</b>/10</div>
        <div class="pill">ìµœê³ : <b id="best">0</b></div>
      </div>

      <div class="game" id="game" aria-label="game">
        <div class="spaceLayer" aria-hidden="true"></div>
        <div class="streak s1" aria-hidden="true"></div>
        <div class="streak s2" aria-hidden="true"></div>

        <div class="player" id="player" aria-label="jet">
          <div class="jetSprite" id="jetSprite"></div>
        </div>

        <div class="touchHint" id="touchHint" aria-hidden="true">
          <div class="hintHand">ğŸ‘‡</div>
          <div class="hintArrow">â¬‡ï¸</div>
          <div class="hintText">ì—¬ê¸° í„°ì¹˜</div>
        </div>

        <!-- ì‹œì‘ í™”ë©´ -->
        <div class="overlay" id="overlay">
          <div class="startBg" id="startBg"></div>
          <div class="startParticles" id="startParticles"></div>
          <div class="scanlines"></div>
          <div class="startVignette"></div>

          <div class="startUI">
            <div class="pressStart">PRESS START</div>
            <div class="startHint">
              ë³´ë¼ í­íƒ„ì„ í”¼í•˜ê³  í™©ê¸ˆ ë³„ì„ ëª¨ì•„ ì—…ê·¸ë ˆì´ë“œ!<br/>
              10ê°œë§ˆë‹¤ 1ë ˆë²¨, ë ˆë²¨ë‹¹ ë³„ íšë“ëŸ‰ 5% ì¦ê°€
            </div>
            <button class="primary" id="startBtn">ì‹œì‘í•˜ê¸°</button>
          </div>
        </div>
      </div>

      <div class="btnRow">
        <button id="restartBtn">ë¦¬ì…‹</button>
        <button id="hardBtn" class="primary">ë‚œì´ë„: EASY</button>
      </div>

      <div class="help">
        ì¡°ì‘: PCëŠ” A/D(ì¢Œìš°) ë˜ëŠ” ë°©í–¥í‚¤, ëª¨ë°”ì¼ì€ ì œíŠ¸ê¸°ë¥¼ ë“œë˜ê·¸<br/>
        ëª©í‘œ: ìƒì¡´ ì‹œê°„ + ë³„ ì ìˆ˜. ë§ìœ¼ë©´ ê²Œì„ ì˜¤ë²„!
      </div>
    </div>
  </div>

  <script>
    const game = document.getElementById("game");
    const player = document.getElementById("player");
    const jetSprite = document.getElementById("jetSprite");

    const overlay = document.getElementById("overlay");
    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");
    const hardBtn = document.getElementById("hardBtn");
    const touchHint = document.getElementById("touchHint");
    const startBg = document.getElementById("startBg");
    const startParticles = document.getElementById("startParticles");

    const timeEl = document.getElementById("time");
    const scoreEl = document.getElementById("score");
    const levelEl = document.getElementById("level");
    const bestEl = document.getElementById("best");

    // âœ… ì‹œì‘ í™”ë©´ ì´ë¯¸ì§€ (blob â†’ raw)
    const START_SCREEN_URL =
      "https://github.com/ttjdwls777-eng/-/blob/main/%EA%B2%8C%EC%9E%84%EC%8B%9C%EC%9E%91%20%ED%99%94%EB%A9%B4.png?raw=1";

    const JET_RAW_URL =
      "https://raw.githubusercontent.com/faglobalxgp2024-design/index.html/main/%EA%B2%8C%EC%9E%84%EC%A1%B4.png";

    const HAZARD_SVG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Cdefs%3E%3CradialGradient id='g' cx='30%25' cy='25%25' r='70%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff' stop-opacity='.65'/%3E%3Cstop offset='40%25' stop-color='%235b2bbf' stop-opacity='1'/%3E%3Cstop offset='100%25' stop-color='%23210a4f' stop-opacity='1'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='44' cy='52' r='30' fill='url(%23g)' stroke='%23ffffff' stroke-opacity='.9' stroke-width='4'/%3E%3Cpath d='M30 48c8-10 16 10 24 0s16 10 24 0' fill='none' stroke='%237df9ff' stroke-opacity='.65' stroke-width='3'/%3E%3Cpath d='M34 60c10-8 12 8 22 0s14 8 22 0' fill='none' stroke='%23ffd166' stroke-opacity='.45' stroke-width='2.5'/%3E%3C/svg%3E";
    const STAR_SVG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Cdefs%3E%3CradialGradient id='s' cx='50%25' cy='35%25' r='70%25'%3E%3Cstop offset='0%25' stop-color='%23fff4b3'/%3E%3Cstop offset='55%25' stop-color='%23ffd166'/%3E%3Cstop offset='100%25' stop-color='%23ff9a3c'/%3E%3C/radialGradient%3E%3C/defs%3E%3Cpath d='M48 6l11 24 26 3-19 18 5 26-23-13-23 13 5-26L11 33l26-3z' fill='url(%23s)' stroke='%23ffffff' stroke-opacity='.85' stroke-width='3'/%3E%3C/svg%3E";

    // ===== íˆíŠ¸ë°•ìŠ¤ íŠœë‹(í•µì‹¬) =====
    // í­íƒ„ì€ ì´ë¯¸ì§€ê°€ ë‘¥ê¸€ê³  ì‹¤ì œë¡œëŠ” ì—¬ë°±ì´ ìˆì–´ì„œ íŒì •ì„ ì¤„ì—¬ì•¼ í•¨
    const PLAYER_HIT_SCALE = 0.82; // í”Œë ˆì´ì–´ íŒì • ì•½ê°„ ì¶•ì†Œ
    const HAZARD_HIT_SCALE = 0.62; // âœ… í­íƒ„ íŒì • í¬ê²Œ ì¶•ì†Œ(ì¶”ì²œ)
    const STAR_HIT_SCALE   = 0.85; // ë³„ì€ ì¡°ê¸ˆë§Œ ì¶•ì†Œ

    // ===== ì‚¬ìš´ë“œ =====
    let audioCtx = null;
    let audioReady = null;

    function ensureAudioReady(){
      if (!audioReady) audioReady = initAudio();
      return audioReady;
    }
    async function initAudio(){
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state !== "running") {
        try { await audioCtx.resume(); } catch(e) {}
      }
    }
    function beep({ freq=440, dur=0.08, type="square", vol=0.18, endFreq=null } = {}){
      if (!audioCtx || audioCtx.state !== "running") return;
      const t = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = type;
      osc.frequency.setValueAtTime(freq, t);
      if (endFreq != null) osc.frequency.exponentialRampToValueAtTime(Math.max(40, endFreq), t + dur);

      gain.gain.setValueAtTime(0.0001, t);
      gain.gain.exponentialRampToValueAtTime(vol, t + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, t + dur);

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start(t);
      osc.stop(t + dur + 0.02);
    }
    function sfxStart(){
      ensureAudioReady().then(() => {
        beep({ freq: 523, dur: 0.06, type:"square", vol:0.12 });
        setTimeout(() => beep({ freq: 659, dur: 0.07, type:"square", vol:0.12 }), 70);
      }).catch(()=>{});
    }
    function sfxCoin(){
      ensureAudioReady().then(() => {
        beep({ freq: 880, dur: 0.05, type:"triangle", vol:0.10, endFreq: 1200 });
      }).catch(()=>{});
    }
    function sfxOver(){
      ensureAudioReady().then(() => {
        beep({ freq: 140, dur: 0.10, type:"square",  vol:0.28, endFreq: 70 });
        setTimeout(() => beep({ freq: 90, dur: 0.12, type:"sawtooth", vol:0.22, endFreq: 40 }), 70);
      }).catch(()=>{});
    }

    // ===== ì‹œì‘ í™”ë©´ íŒŒí‹°í´ ìƒì„±(ê°€ë²¼ìš´ DOM, 18ê°œë§Œ) =====
    function buildStartParticles(){
      startParticles.innerHTML = "";
      const N = 18;
      for (let i=0;i<N;i++){
        const p = document.createElement("div");
        p.className = "sp " + (i%3===0 ? "a" : (i%3===1 ? "b" : ""));
        const sx = (Math.random()*100).toFixed(1) + "vw";
        const sy = (Math.random()*100).toFixed(1) + "vh";
        const dx = (Math.random()*80 - 40).toFixed(1) + "px";
        p.style.setProperty("--sx", sx);
        p.style.setProperty("--sy", sy);
        p.style.setProperty("--dx", dx);
        p.style.animationDelay = (Math.random()*2.2).toFixed(2) + "s";
        p.style.animationDuration = (2.0 + Math.random()*1.8).toFixed(2) + "s";
        startParticles.appendChild(p);
      }
    }

    // ===== ê²Œì„ ìƒíƒœ =====
    let running = false;
    let raf = null;
    let lastTime = 0;
    let startAt = 0;

    const isMobile = matchMedia("(max-width: 600px)").matches;
    const pSize = isMobile ? 62 : 56;

    const modes = [
      { name:"EASY", hazardRate: 640, hazardSpeed: 230, starRate: 1020, starSpeed: 160, zigzag:false },
      { name:"HARD", hazardRate: 420, hazardSpeed: 305, starRate: 1200, starSpeed: 185, zigzag:true }
    ];
    let modeIdx = 0;

    let gW = 0, gH = 0;
    let px = 0, py = 0;
    let lastPx = 0;

    let scorePoints = 0;
    let totalStarsCollected = 0;
    let level = 0;

    let best = Number(localStorage.getItem("xgp_best_v4") || 0);
    bestEl.textContent = best;

    const hazards = [];
    const stars = [];

    let hazardTimer = null;
    let starTimer = null;

    function measureGame(){
      const r = game.getBoundingClientRect();
      gW = r.width;
      gH = r.height;
    }
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    // 10ë‹¨ê³„ë§ˆë‹¤ ìƒ‰/í•„í„° ë³€í™”
    function applyJetTier(){
      const tier = Math.floor(level / 10); // 0~10
      const hue = tier * 18;
      const sat = 1 + tier * 0.03;
      const con = 1 + tier * 0.015;
      const glow = 0.12 + tier * 0.02;
      jetSprite.style.filter =
        `hue-rotate(${hue}deg) saturate(${sat}) contrast(${con}) drop-shadow(0 0 10px rgba(125,249,255,${glow}))`;
    }

    function gainMultiplier(){
      return Math.pow(1.05, level);
    }

    function recalcLevel(){
      const newLevel = Math.min(100, Math.floor(totalStarsCollected / 10));
      if (newLevel !== level){
        level = newLevel;
        levelEl.textContent = String(level);
        applyJetTier();
        popText(px + pSize/2, py - 12, "LV UP!");
      } else {
        levelEl.textContent = String(level);
      }
    }

    function setPlayerX(x){
      px = clamp(Math.round(x), 0, Math.round(gW - pSize));
      const dx = px - lastPx;
      lastPx = px;
      const tilt = clamp(dx * 0.55, -14, 14);
      player.style.transform = `translate3d(${px}px, ${py}px, 0) rotate(${tilt}deg)`;
    }

    function positionPlayer(){
      py = Math.round(gH * 0.74);
      player.style.width = pSize + "px";
      player.style.height = pSize + "px";
      player.style.transform = `translate3d(${px}px, ${py}px, 0) rotate(0deg)`;
      lastPx = px;
    }

    function showTouchHint(show){
      touchHint.style.display = show ? "block" : "none";
      if (!show) return;
      touchHint.style.left = Math.round(px + pSize/2) + "px";
      touchHint.style.top  = Math.round(py + pSize + 8) + "px";
    }

    function popText(x, y, text){
      const el = document.createElement("div");
      el.className = "pop";
      el.textContent = text;
      el.style.left = Math.round(x) + "px";
      el.style.top = Math.round(y) + "px";
      game.appendChild(el);
      setTimeout(()=> el.remove(), 750);
    }

    function spawnExplosion(x, y){
      const ex = document.createElement("div");
      ex.className = "explosion";
      ex.style.left = Math.round(x) + "px";
      ex.style.top  = Math.round(y) + "px";
      game.appendChild(ex);
      setTimeout(() => ex.remove(), 520);
    }

    // âœ… ìŠ¤ì¼€ì¼ ì ìš© AABB(íˆíŠ¸ë°•ìŠ¤ ì¶•ì†Œ)
    function aabbScaled(ax, ay, aw, ah, as, bx, by, bw, bh, bs){
      const aW = aw * as, aH = ah * as;
      const bW = bw * bs, bH = bh * bs;

      const aX = ax + (aw - aW)/2;
      const aY = ay + (ah - aH)/2;

      const bX = bx + (bw - bW)/2;
      const bY = by + (bh - bH)/2;

      return !(aX + aW < bX || aX > bX + bW || aY + aH < bY || aY > bY + bH);
    }

    function spawnHazard(){
      const el = document.createElement("div");
      el.className = "hazard";
      el.style.backgroundImage = `url("${HAZARD_SVG}")`;

      const x = Math.random() * (gW - 36);
      const y = -70;
      const zig = modes[modeIdx].zigzag;
      const vx = zig ? (Math.random() < 0.5 ? -1 : 1) * (80 + Math.random()*90) : 0;

      const obj = { el, x, y, vx, w:36, h:36 };
      hazards.push(obj);

      el.style.setProperty("--x", x + "px");
      el.style.setProperty("--y", y + "px");

      game.appendChild(el);
    }

    function spawnStar(){
      const el = document.createElement("div");
      el.className = "star";
      el.style.backgroundImage = `url("${STAR_SVG}")`;

      const x = Math.random() * (gW - 28);
      const y = -60;

      const obj = { el, x, y, w:28, h:28 };
      stars.push(obj);

      el.style.setProperty("--x", x + "px");
      el.style.setProperty("--y", y + "px");

      game.appendChild(el);
    }

    function clearObjects(){
      for (const o of hazards) o.el.remove();
      for (const o of stars) o.el.remove();
      hazards.length = 0;
      stars.length = 0;
      [...game.querySelectorAll(".pop,.explosion")].forEach(el => el.remove());
    }

    function stop(){
      running = false;
      if (raf) cancelAnimationFrame(raf);
      raf = null;
      if (hazardTimer){ clearInterval(hazardTimer); hazardTimer = null; }
      if (starTimer){ clearInterval(starTimer); starTimer = null; }
    }

    function showOverlay(){ overlay.style.display = "flex"; buildStartParticles(); }
    function hideOverlay(){ overlay.style.display = "none"; }

    function reset(){
      stop();
      measureGame();
      clearObjects();

      scorePoints = 0;
      totalStarsCollected = 0;
      level = 0;

      scoreEl.textContent = "0";
      timeEl.textContent = "0.0";
      levelEl.textContent = "0";

      px = Math.round(gW/2 - pSize/2);
      positionPlayer();
      showTouchHint(true);
      applyJetTier();

      startBtn.textContent = "ì‹œì‘í•˜ê¸°";
      showOverlay();
    }

    function start(){
      reset();
      hideOverlay();
      showTouchHint(false);

      running = true;
      startAt = performance.now();
      lastTime = startAt;

      const m = modes[modeIdx];
      hazardTimer = setInterval(spawnHazard, m.hazardRate);
      starTimer = setInterval(spawnStar, m.starRate);

      raf = requestAnimationFrame(tick);
    }

    function gameOver(){
      if (!running) return;
      stop();
      sfxOver();

      const lived = (performance.now() - startAt) / 1000;
      const final = Math.floor(scorePoints * 10 + lived * 5);

      if (final > best) {
        best = final;
        localStorage.setItem("xgp_best_v4", String(best));
        bestEl.textContent = best;
      }

      game.classList.remove("shake");
      void game.offsetWidth;
      game.classList.add("shake");

      startBtn.textContent = "ë‹¤ì‹œ ì‹œì‘";
      showOverlay();
    }

    function tick(now){
      if (!running) return;
      const dt = Math.min(0.033, (now - lastTime) / 1000);
      lastTime = now;

      const lived = (now - startAt) / 1000;
      timeEl.textContent = lived.toFixed(1);

      const progress = Math.min(Math.max((lived - 10) / 110, 0), 1);
      const speedMultiplier = 1 + progress;
      const m = modes[modeIdx];

      for (let i = hazards.length - 1; i >= 0; i--){
        const h = hazards[i];
        h.y += m.hazardSpeed * speedMultiplier * dt;

        if (m.zigzag){
          h.x += h.vx * dt * (0.85 + progress*0.65);
          const minX = 0;
          const maxX = gW - h.w;
          if (h.x <= minX){ h.x = minX; h.vx = Math.abs(h.vx); }
          if (h.x >= maxX){ h.x = maxX; h.vx = -Math.abs(h.vx); }
        }

        if (h.y > gH + 120){
          h.el.remove();
          hazards.splice(i, 1);
          continue;
        }

        h.el.style.setProperty("--x", h.x + "px");
        h.el.style.setProperty("--y", h.y + "px");

        // âœ… í­íƒ„ íŒì • ì¶•ì†Œ ì ìš©
        if (aabbScaled(px, py, pSize, pSize, PLAYER_HIT_SCALE, h.x, h.y, h.w, h.h, HAZARD_HIT_SCALE)){
          spawnExplosion(h.x + h.w/2, h.y + h.h/2);
          gameOver();
          return;
        }
      }

      for (let i = stars.length - 1; i >= 0; i--){
        const s = stars[i];
        s.y += m.starSpeed * (speedMultiplier * 1.45) * dt;

        if (s.y > gH + 120){
          s.el.remove();
          stars.splice(i, 1);
          continue;
        }

        s.el.style.setProperty("--x", s.x + "px");
        s.el.style.setProperty("--y", s.y + "px");

        if (aabbScaled(px, py, pSize, pSize, PLAYER_HIT_SCALE, s.x, s.y, s.w, s.h, STAR_HIT_SCALE)){
          sfxCoin();
          s.el.remove();
          stars.splice(i, 1);

          totalStarsCollected += 1;
          recalcLevel();

          const gain = gainMultiplier();
          scorePoints += gain;

          scoreEl.textContent = (scorePoints >= 1000)
            ? scorePoints.toFixed(0)
            : scorePoints.toFixed(1);

          popText(px + 4, py - 10, "+" + (gain >= 10 ? gain.toFixed(1) : gain.toFixed(2)));
        }
      }

      raf = requestAnimationFrame(tick);
    }

    // ===== ì…ë ¥ =====
    const keyState = { left:false, right:false };
    function moveBy(dx){ setPlayerX(px + dx); }

    window.addEventListener("keydown", (e) => {
      const k = e.key.toLowerCase();
      if (e.key === "ArrowLeft" || k === "a") keyState.left = true;
      if (e.key === "ArrowRight" || k === "d") keyState.right = true;
    });
    window.addEventListener("keyup", (e) => {
      const k = e.key.toLowerCase();
      if (e.key === "ArrowLeft" || k === "a") keyState.left = false;
      if (e.key === "ArrowRight" || k === "d") keyState.right = false;
    });

    function controlLoop(){
      const speed = isMobile ? 7 : 6;
      if (keyState.left) moveBy(-speed);
      if (keyState.right) moveBy(speed);
      requestAnimationFrame(controlLoop);
    }
    requestAnimationFrame(controlLoop);

    let dragging = false;
    function pointerX(e){
      const rect = game.getBoundingClientRect();
      const clientX = (e.touches ? e.touches[0].clientX : e.clientX);
      let x = clientX - rect.left;
      if (e.touches) x -= 28;
      return x - pSize/2;
    }
    game.addEventListener("mousedown", (e)=>{ dragging = true; setPlayerX(pointerX(e)); });
    window.addEventListener("mousemove", (e)=>{ if(dragging) setPlayerX(pointerX(e)); });
    window.addEventListener("mouseup", ()=> dragging = false);

    game.addEventListener("touchstart", (e)=>{ dragging = true; setPlayerX(pointerX(e)); }, {passive:false});
    game.addEventListener("touchmove", (e)=>{ if(dragging) setPlayerX(pointerX(e)); }, {passive:false});
    game.addEventListener("touchend", ()=> dragging = false);

    // ===== ë²„íŠ¼ =====
    startBtn.addEventListener("click", () => {
      ensureAudioReady().then(() => { sfxStart(); start(); }).catch(() => start());
    });
    restartBtn.addEventListener("click", () => reset());
    hardBtn.addEventListener("click", () => {
      modeIdx = (modeIdx + 1) % modes.length;
      hardBtn.textContent = "ë‚œì´ë„: " + modes[modeIdx].name;
      reset();
    });

    window.addEventListener("resize", () => {
      measureGame();
      px = clamp(px, 0, gW - pSize);
      positionPlayer();
      showTouchHint(!running);
    });

    // ===== ì´ë¯¸ì§€ ì ìš© =====
    (function applyImages(){
      jetSprite.style.backgroundImage = `url("${JET_RAW_URL}")`;
      startBg.style.backgroundImage = `url("${START_SCREEN_URL}")`;
      buildStartParticles();
    })();

    // ì´ˆê¸° ì‹œì‘
    measureGame();
    reset();
  </script>
</body>
</html>
