<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, user-scalable=no" />
  <title>XGP ë¯¸ë‹ˆê²Œì„ (SHOP ì—…ê·¸ë ˆì´ë“œ + ìŠ¤í‚¨ + í­íƒ„ 8ì¢…)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root{
      --txt:#fff6e6;
      --muted:#ffd9a6;
      --line:#ffb347;

      --panel: rgba(20,12,40,.55);
      --accent:#7df9ff;
      --warn:#ffd166;
      --danger:#ff4d4d;

      --uiShadow: 0 12px 40px rgba(0,0,0,.35);

      /* Jet VFX variables (tier-based) */
      --jetAuraA: 0.18;
      --jetAuraB: 0.08;
      --jetAuraHue: 190deg;
      --jetRingA: 0.18;
      --jetRingHue: 190deg;
      --trailA: 0.55;
      --trailHue: 190deg;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:"Press Start 2P", system-ui, sans-serif;
      color:var(--txt);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;

      background:
        radial-gradient( circle at 15% 20%, rgba(255,255,255,.18), transparent 35% ),
        radial-gradient( circle at 85% 35%, rgba(255,120,60,.20), transparent 42% ),
        radial-gradient( circle at 20% 85%, rgba(0,255,255,.08), transparent 45% ),
        linear-gradient( 135deg, #1a1f4a 0%, #1b1f3a 22%, #2d1557 48%, #b31217 100% );
    }

    .posterGrid{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.24;
      mix-blend-mode:screen;
      background:
        linear-gradient(to right, rgba(255,255,255,.09) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.07) 1px, transparent 1px);
      background-size: 64px 64px;
      transform: perspective(900px) rotateX(7deg);
      filter: blur(.2px);
    }
    .grain{
      position:fixed; inset:-40%;
      pointer-events:none;
      opacity:.09;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      animation: grainMove 6s steps(8) infinite;
      mix-blend-mode: overlay;
    }
    @keyframes grainMove{
      0%{ transform: translate(0,0) rotate(0deg); }
      25%{ transform: translate(-2%,1%) rotate(1deg); }
      50%{ transform: translate(2%,-1%) rotate(-1deg); }
      75%{ transform: translate(-1%,-2%) rotate(1deg); }
      100%{ transform: translate(0,0) rotate(0deg); }
    }

    .wrap{ width:100%; max-width:560px; }

    .title{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-bottom:12px;
      text-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .title h1{ font-size:14px; margin:0; letter-spacing:1px; }
    .title .mini{ font-size:9px; color:var(--muted); }

    .card{
      background:
        radial-gradient(circle at 20% 10%, rgba(255,255,255,.10), transparent 40%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:2px solid var(--line);
      border-radius:16px;
      padding:14px;
      box-shadow: var(--uiShadow);
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(2px);
    }

    .hud{
      display:flex;
      gap:10px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .pill{
      flex:1;
      min-width:150px;
      background: var(--panel);
      border:2px solid rgba(255,180,90,.85);
      border-radius:12px;
      padding:10px 10px;
      font-size:10px;
      color:var(--muted);
      box-shadow: inset 0 0 22px rgba(255,160,60,.10);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .pill b{ color:var(--txt); }

    .game{
      position:relative;
      width:100%;
      aspect-ratio: 3 / 4;
      max-height: 80vh;
      overflow:hidden;
      border:2px solid var(--line);
      border-radius:14px;
      background:
        radial-gradient(circle at 40% 25%, rgba(125,249,255,.10), transparent 45%),
        radial-gradient(circle at 75% 70%, rgba(255,120,60,.12), transparent 40%),
        linear-gradient(180deg, #0b0e22 0%, #070812 100%);
      box-shadow:
        inset 0 0 60px rgba(255,120,40,0.12),
        0 16px 36px rgba(0,0,0,.35);
      touch-action:none;
      contain: layout paint size;
    }

    .spaceLayer{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:1;
      z-index:0;
    }
    .spaceLayer::before,
    .spaceLayer::after{
      content:"";
      position:absolute; inset:-20%;
      background-image:
        radial-gradient(#ffffffcc 1px, transparent 1px),
        radial-gradient(#ffffff88 1px, transparent 1px),
        radial-gradient(#ffffff55 1px, transparent 1px),
        radial-gradient(rgba(125,249,255,.55) 1px, transparent 1px);
      background-size: 110px 110px, 170px 170px, 240px 240px, 320px 320px;
      background-position: 0 0, 40px 70px, 90px 10px, 120px 150px;
      filter: drop-shadow(0 0 6px rgba(125,249,255,.16));
      transform: rotate(6deg);
      animation: starDrift 8.5s linear infinite;
      opacity:.85;
    }
    .spaceLayer::after{
      opacity:.55;
      filter: drop-shadow(0 0 8px rgba(255,170,60,.14));
      animation-duration: 5.8s;
      animation-direction: reverse;
      transform: rotate(-4deg);
    }
    @keyframes starDrift{
      from{ transform: translateY(0) translateX(0) rotate(6deg); }
      to  { transform: translateY(240px) translateX(-40px) rotate(6deg); }
    }

    .streak{
      position:absolute;
      width:220px; height:2px;
      background: linear-gradient(to right, transparent, rgba(255,255,255,.9), transparent);
      filter: drop-shadow(0 0 10px rgba(125,249,255,.35));
      transform: rotate(18deg);
      opacity:0;
      pointer-events:none;
      animation: streak 2.8s linear infinite;
      z-index:0;
    }
    .streak.s2{ animation-delay: .9s; top:35%; left:-40%; }
    .streak.s1{ top:18%; left:-60%; }
    @keyframes streak{
      0%{ transform: translateX(0) rotate(18deg); opacity:0; }
      10%{ opacity:.55; }
      35%{ opacity:.9; }
      60%{ opacity:.55; }
      100%{ transform: translateX(160vw) rotate(18deg); opacity:0; }
    }

    /* ===== PLAYER ===== */
    .player{
      position:absolute;
      width:56px;
      height:56px;
      z-index:5;
      will-change: transform;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.35));
      transform: translate3d(0,0,0) rotate(0deg);
    }

    .player::after{
      content:"";
      position:absolute;
      inset:-14px;
      border-radius:999px;
      background:
        radial-gradient(circle at 50% 50%,
          rgba(125,249,255,var(--jetAuraA)) 0%,
          rgba(125,249,255,var(--jetAuraB)) 38%,
          rgba(0,0,0,0) 70%);
      filter:
        hue-rotate(var(--jetAuraHue))
        drop-shadow(0 0 18px rgba(125,249,255,0.25));
      opacity:.95;
      pointer-events:none;
      mix-blend-mode: screen;
      animation: auraPulse 1.05s ease-in-out infinite;
    }
    @keyframes auraPulse{
      0%,100%{ transform: scale(0.98); opacity:.86; }
      50%{ transform: scale(1.06); opacity:1; }
    }

    .jetSprite{
      width:100%;
      height:100%;
      background-repeat:no-repeat;
      background-position:center;
      background-size:contain;
      image-rendering:auto;
      transition: filter 260ms ease, transform 260ms ease;
      filter: none;
    }

    .player::before{
      content:"";
      position:absolute;
      left:50%;
      bottom:-6px;
      width:8px;
      height:12px;
      transform: translateX(-50%);
      background:
        radial-gradient(circle at 50% 8%, rgba(255,255,255,.55) 0 20%, transparent 21%),
        radial-gradient(circle at 50% 42%, rgba(255,209,102,.92) 0 52%, transparent 53%),
        radial-gradient(circle at 50% 78%, rgba(255,106,61,.92) 0 78%, transparent 79%);
      filter:
        hue-rotate(var(--trailHue))
        drop-shadow(0 0 7px rgba(255,170,60,.45))
        drop-shadow(0 0 14px rgba(125,249,255,var(--trailA)));
      border-radius: 999px;
      opacity:.85;
      animation: flameFlicker .11s infinite alternate;
      pointer-events:none;
    }
    @keyframes flameFlicker{
      from{ transform: translateX(-50%) scaleY(.92) scaleX(.98) translateY(0); opacity:.72; }
      to  { transform: translateX(-50%) scaleY(1.18) scaleX(1.02) translateY(1px); opacity:.96; }
    }

    /* ===== OBJECTS ===== */
    .hazard, .star, .jetParticle, .tierRing{
      position:absolute;
      pointer-events:none;
      z-index:3;
      will-change: transform;
      opacity:1;
      transform: translate3d(var(--x, 0px), var(--y, 0px), 0);
    }

    .hazard{
      border-radius:50%;
      background-size:contain;
      background-repeat:no-repeat;
      background-position:center;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.45)) drop-shadow(0 0 14px rgba(140,90,255,.35));
      animation: hazardWiggle .55s ease-in-out infinite;
    }
    @keyframes hazardWiggle{
      0%,100%{ transform: translate3d(var(--x,0px), var(--y,0px), 0) rotate(-2deg) scale(1); }
      50%     { transform: translate3d(var(--x,0px), var(--y,0px), 0) rotate( 2deg) scale(1.03); }
    }
    .hazard.spin{
      animation: hazardSpin .45s linear infinite;
    }
    @keyframes hazardSpin{
      from{ transform: translate3d(var(--x,0px), var(--y,0px), 0) rotate(0deg); }
      to  { transform: translate3d(var(--x,0px), var(--y,0px), 0) rotate(360deg); }
    }

    .star{
      width:28px; height:28px;
      background-size:contain;
      background-repeat:no-repeat;
      background-position:center;
      filter: drop-shadow(0 0 12px rgba(255,210,90,.45));
      animation: starPulse .75s ease-in-out infinite;
    }
    @keyframes starPulse{
      0%,100%{ transform: translate3d(var(--x,0px), var(--y,0px), 0) scale(1); }
      50%     { transform: translate3d(var(--x,0px), var(--y,0px), 0) scale(1.12); }
    }

    .jetParticle{
      width:6px; height:6px;
      border-radius:999px;
      background:
        radial-gradient(circle at 35% 35%, rgba(255,255,255,.9), rgba(255,255,255,.0) 60%),
        radial-gradient(circle at 60% 60%, rgba(125,249,255,.85), rgba(0,0,0,0) 62%);
      filter: hue-rotate(var(--trailHue)) drop-shadow(0 0 10px rgba(125,249,255,.22));
      opacity:.95;
      z-index:4;
      animation: jp 520ms ease-out forwards;
      transform: translate3d(var(--x,0px), var(--y,0px), 0);
    }
    @keyframes jp{
      from{ opacity:.95; transform: translate3d(var(--x,0px), var(--y,0px), 0) scale(1); }
      to{ opacity:0; transform: translate3d(calc(var(--x,0px) + var(--dx,0px)), calc(var(--y,0px) + var(--dy,20px)), 0) scale(.2); }
    }

    .tierRing{
      width:160px; height:160px;
      transform: translate(-50%,-50%);
      border-radius:999px;
      background:
        radial-gradient(circle at 50% 50%,
          rgba(255,255,255,.0) 0%,
          rgba(255,255,255,.0) 45%,
          rgba(125,249,255,var(--jetRingA)) 55%,
          rgba(0,0,0,0) 72%);
      filter: hue-rotate(var(--jetRingHue)) drop-shadow(0 0 22px rgba(125,249,255,.28));
      mix-blend-mode: screen;
      opacity:0;
      pointer-events:none;
      z-index:12;
      animation: ring 520ms ease-out forwards;
    }
    @keyframes ring{
      0%{ opacity:0; transform: translate(-50%,-50%) scale(.45); }
      20%{ opacity:1; }
      100%{ opacity:0; transform: translate(-50%,-50%) scale(1.55); }
    }

    .explosion{
      position:absolute;
      width:120px;
      height:120px;
      transform: translate(-50%, -50%);
      pointer-events:none;
      border-radius:999px;
      opacity:0;
      filter: drop-shadow(0 0 18px rgba(255,160,60,.65));
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cdefs%3E%3CradialGradient id='a' cx='50%25' cy='50%25' r='60%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff'/%3E%3Cstop offset='28%25' stop-color='%23fff1a8'/%3E%3Cstop offset='55%25' stop-color='%23ffd166'/%3E%3Cstop offset='78%25' stop-color='%23ff6a3d'/%3E%3Cstop offset='100%25' stop-color='%23d11f2f'/%3E%3C/radialGradient%3E%3C/defs%3E%3Cpath d='M80 8l10 22 18-16 2 24 22-10-10 22 24 2-16 18 22 10-22 10 16 18-24 2 10 22-22-10-2 24-18-16-10 22-10-22-18 16-2-24-22 10 10-22-24-2 16-18-22-10 22-10-16-18 24-2-10-22 22 10 2-24 18 16z' fill='url(%23a)'/%3E%3Ccircle cx='80' cy='80' r='28' fill='%23ffffff' fill-opacity='.35'/%3E%3C/svg%3E");
      background-size:contain;
      background-repeat:no-repeat;
      background-position:center;
      animation: boom .42s ease-out forwards;
      z-index:10;
    }
    @keyframes boom{
      0%{ transform: translate(-50%, -50%) scale(.35); opacity:0; }
      15%{ opacity:1; }
      65%{ transform: translate(-50%, -50%) scale(1.85); opacity:1; }
      100%{ transform: translate(-50%, -50%) scale(2.5); opacity:0; }
    }

    .shake{ animation: shake .18s linear 3; }
    @keyframes shake{
      0%{ transform: translate(0,0); }
      25%{ transform: translate(3px, -2px); }
      50%{ transform: translate(-3px, 2px); }
      75%{ transform: translate(2px, 2px); }
      100%{ transform: translate(0,0); }
    }

    .btnRow{ display:flex; gap:10px; margin-top:12px; }
    button{
      flex:1;
      border:2px solid var(--line);
      background: var(--panel);
      color: var(--txt);
      font-family: inherit;
      padding:12px 10px;
      border-radius:12px;
      font-size:10px;
      cursor:pointer;
      box-shadow: inset 0 0 20px rgba(255,170,60,.10);
    }
    button:active{ transform: translateY(1px); }
    .primary{ border-color: var(--accent); }
    .danger{ border-color: var(--danger); color: #ffecec; }

    .help{
      margin-top:10px;
      color:var(--muted);
      font-size:9px;
      line-height:1.55;
      opacity:.95;
    }

    /* ===== Overlay / Start / SHOP ===== */
    .overlay{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0;
      z-index: 30;
      overflow:hidden;
    }

    .startBg{
      position:absolute; inset:0;
      background-position:center;
      background-size:cover;
      background-repeat:no-repeat;
      transform: scale(1.02);
      animation: startPan 6.5s ease-in-out infinite alternate;
      filter: saturate(1.1) contrast(1.05);
    }
    @keyframes startPan{
      from{ transform: scale(1.04) translate3d(-8px,-6px,0); }
      to  { transform: scale(1.08) translate3d(10px,8px,0); }
    }

    .scanlines{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.28;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255,255,255,.06) 0px,
          rgba(255,255,255,.06) 1px,
          rgba(0,0,0,0) 3px,
          rgba(0,0,0,0) 6px
        );
      mix-blend-mode: overlay;
      animation: scanMove 2.2s linear infinite;
    }
    @keyframes scanMove{
      from{ transform: translateY(0); }
      to  { transform: translateY(24px); }
    }

    .startVignette{
      position:absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(circle at 50% 40%, rgba(0,0,0,0) 32%, rgba(0,0,0,.55) 82%),
        linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.62));
    }

    .startUI{
      position:absolute;
      left:0; right:0; bottom:0;
      padding:16px 14px calc(14px + env(safe-area-inset-bottom));
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.72));
    }

    .pressStart{
      font-size:14px;
      letter-spacing:1px;
      color: #eaffff;
      text-shadow:
        0 0 10px rgba(125,249,255,.55),
        0 0 22px rgba(125,249,255,.35),
        0 10px 35px rgba(0,0,0,.55);
      animation: neonPulse 1.1s ease-in-out infinite;
      user-select:none;
      margin-bottom: 2px;
    }
    @keyframes neonPulse{
      0%,100%{ transform: translateY(0); filter: brightness(1); opacity:1; }
      50%{ transform: translateY(-2px); filter: brightness(1.15); opacity:.92; }
    }

    .startHint{
      font-size:9px;
      color:var(--muted);
      text-shadow: 2px 2px 0 rgba(0,0,0,.45);
      line-height:1.6;
      text-align:center;
      opacity:.98;
    }

    .shop{
      width: calc(100% - 12px);
      max-width: 520px;
      border:2px solid rgba(125,249,255,.55);
      background: rgba(12,8,24,.55);
      border-radius: 14px;
      padding: 12px;
      box-shadow: var(--uiShadow);
      backdrop-filter: blur(2px);
    }

    .shopRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      margin-top: 8px;
    }

    .shopStat{
      flex:1;
      min-width: 210px;
      border:2px solid rgba(255,180,90,.65);
      border-radius: 12px;
      padding: 10px;
      font-size: 10px;
      background: rgba(20,12,40,.45);
      color: var(--muted);
      box-shadow: inset 0 0 22px rgba(255,160,60,.08);
    }
    .shopStat b{ color: var(--txt); }

    .shopBtns button{
      min-width: 120px;
      flex: 1;
    }

    .shopSmall{
      font-size: 8px;
      color: rgba(255,217,166,.92);
      line-height: 1.55;
      text-align:center;
      margin-top: 6px;
      opacity: .98;
    }

    .pop{
      position:absolute;
      font-size:10px;
      color: var(--warn);
      text-shadow: 2px 2px 0 rgba(0,0,0,.45);
      animation: pop 700ms ease-out forwards;
      pointer-events:none;
      z-index: 10;
      will-change: transform, opacity;
    }
    @keyframes pop{
      from{ transform: translateY(0); opacity:1; }
      to{ transform: translateY(-18px); opacity:0; }
    }

    .touchHint{
      position:absolute;
      left:0; top:0;
      transform: translate(-50%, 0);
      pointer-events:none;
      display:none;
      text-align:center;
      z-index:6;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
    }
    .touchHint .hintHand{ font-size:18px; animation: hintBob .9s ease-in-out infinite; }
    .touchHint .hintArrow{ font-size:14px; opacity:.9; animation: hintBob 1.1s ease-in-out infinite; }
    .touchHint .hintText{
      margin-top:4px;
      font-size:8px;
      color: var(--warn);
      text-shadow: 2px 2px 0 rgba(0,0,0,.45);
    }
    @keyframes hintBob{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(6px); }
    }

    @media (max-width: 600px){
      body{
        padding:0 !important;
        overflow:auto;
        -webkit-overflow-scrolling:touch;
        display:block;
      }
      .card{
        padding:10px;
        padding-bottom: calc(10px + env(safe-area-inset-bottom));
        display:flex;
        flex-direction:column;
        gap:10px;
      }
      .game{
        aspect-ratio:auto;
        height:calc(100vh - 150px);
        max-height:none;
      }
      .help{ display:none; }
      .shopStat{ min-width: 170px; }
    }
  </style>
</head>

<body>
  <div class="posterGrid"></div>
  <div class="grain"></div>

  <div class="wrap">
    <div class="title">
      <h1>XGP ì±„êµ´ê²Œì„</h1>
      <div class="mini">A / D ë˜ëŠ” ë“œë˜ê·¸</div>
    </div>

    <div class="card">
      <div class="hud">
        <div class="pill">ì‹œê°„: <b id="time">0.0</b>s</div>
        <div class="pill">ì ìˆ˜: <b id="score">0</b></div>
        <div class="pill">ë ˆë²¨: <b id="level">0</b>/100</div>
        <div class="pill">STAR: <b id="bank">0</b></div>
        <div class="pill">ìµœê³ : <b id="best">0</b></div>
      </div>

      <div class="game" id="game" aria-label="game">
        <div class="spaceLayer" aria-hidden="true"></div>
        <div class="streak s1" aria-hidden="true"></div>
        <div class="streak s2" aria-hidden="true"></div>

        <div class="player" id="player" aria-label="jet">
          <div class="jetSprite" id="jetSprite"></div>
        </div>

        <div class="touchHint" id="touchHint" aria-hidden="true">
          <div class="hintHand">ğŸ‘‡</div>
          <div class="hintArrow">â¬‡ï¸</div>
          <div class="hintText">ì—¬ê¸° í„°ì¹˜</div>
        </div>

        <!-- ì‹œì‘ í™”ë©´ + SHOP -->
        <div class="overlay" id="overlay">
          <div class="startBg" id="startBg"></div>
          <div class="scanlines"></div>
          <div class="startVignette"></div>

          <div class="startUI">
            <div class="pressStart">PRESS START</div>

            <div class="shop" role="group" aria-label="shop">
              <div class="startHint">
                ì‹œì‘ ì „ì— STARë¡œ ì—…ê·¸ë ˆì´ë“œ! (100 STAR = 1 ì—…ê·¸ë ˆì´ë“œ, ìµœëŒ€ 100)<br/>
                ë ˆë²¨ì€ ê²Œì„ ì¤‘ ë³€í•˜ì§€ ì•Šê³ , ì ìˆ˜ ë°°ìˆ˜ë¡œë§Œ ì ìš©ë¼.
              </div>

              <div class="shopRow">
                <div class="shopStat">ë³´ìœ  STAR: <b id="shopBank">0</b></div>
                <div class="shopStat">êµ¬ë§¤ ë ˆë²¨: <b id="shopLevel">0</b>/100</div>
              </div>

              <div class="shopRow shopBtns" style="margin-top:10px;">
                <button id="buy1" class="primary">+1 (100)</button>
                <button id="buy10" class="primary">+10 (1000)</button>
                <button id="buyMax" class="primary">MAX</button>
              </div>

              <div class="shopRow shopBtns">
                <button id="resetShop" class="danger">STAR/ë ˆë²¨ ì´ˆê¸°í™”</button>
                <button id="startBtn" class="primary">ì‹œì‘í•˜ê¸°</button>
              </div>

              <div class="shopSmall">
                ìŠ¤í‚¨ ë³€í™”: ë ˆë²¨ 0/10/20/30/40...ë§ˆë‹¤ ì œíŠ¸ ìŠ¤í‚¨ì´ â€œì´ë¯¸ì§€ ìì²´ë¡œâ€ ë°”ë€œ + ì˜¤ë¼/íŒŒí‹°í´ ê°•í™”<br/>
                í­íƒ„: 8ì¢…(ê°ê¸° ë‹¤ë¥¸ ì›€ì§ì„/í¬ê¸°/íˆíŠ¸ë°•ìŠ¤)
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="btnRow">
        <button id="restartBtn">ë¦¬ì…‹(ëŸ°)</button>
        <button id="hardBtn" class="primary">ë‚œì´ë„: EASY</button>
      </div>

      <div class="help">
        ì¡°ì‘: PCëŠ” A/D(ì¢Œìš°) ë˜ëŠ” ë°©í–¥í‚¤, ëª¨ë°”ì¼ì€ ì œíŠ¸ê¸°ë¥¼ ë“œë˜ê·¸<br/>
        ëª©í‘œ: í­íƒ„ í”¼í•˜ê³  ë³„ì„ ë¨¹ì–´ ì ìˆ˜ íšë“. ë§ìœ¼ë©´ ê²Œì„ ì˜¤ë²„!
      </div>
    </div>
  </div>

  <script>
    const game = document.getElementById("game");
    const player = document.getElementById("player");
    const jetSprite = document.getElementById("jetSprite");

    const overlay = document.getElementById("overlay");
    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");
    const hardBtn = document.getElementById("hardBtn");
    const touchHint = document.getElementById("touchHint");
    const startBg = document.getElementById("startBg");

    const timeEl = document.getElementById("time");
    const scoreEl = document.getElementById("score");
    const levelEl = document.getElementById("level");
    const bestEl = document.getElementById("best");
    const bankEl = document.getElementById("bank");

    const shopBankEl = document.getElementById("shopBank");
    const shopLevelEl = document.getElementById("shopLevel");
    const buy1Btn = document.getElementById("buy1");
    const buy10Btn = document.getElementById("buy10");
    const buyMaxBtn = document.getElementById("buyMax");
    const resetShopBtn = document.getElementById("resetShop");

    // âœ… ì‹œì‘ í™”ë©´ ì´ë¯¸ì§€
    const START_SCREEN_URL =
      "https://github.com/ttjdwls777-eng/-/blob/main/%EA%B2%8C%EC%9E%84%EC%8B%9C%EC%9E%91%20%ED%99%94%EB%A9%B4.png?raw=1";

    // ===== Jet skins (ë ˆë²¨ 10ë‹¨ìœ„ â€œì´ë¯¸ì§€ ìì²´ ë³€ê²½â€) =====
    // 0/10/20/30/40... -> tier index (0~9 ê°€ëŠ¥í•˜ì§€ë§Œ ì—¬ê¸°ì„  0~5ê¹Œì§€ë§Œ ì§„ì§œ ê°•í•˜ê²Œ)
    function jetSkinSvg({ body="#7df9ff", wing="#ffd166", core="#ffffff", flame="#ff6a3d", accent="#7b2cff" }){
      // ê°„ë‹¨í•˜ì§€ë§Œ â€œë°”ë€ ê²Œ í™•â€ ë³´ì´ë„ë¡ ìƒ‰ ëŒ€ë¹„ ê°•í•œ í”½ì…€/ë ˆíŠ¸ë¡œ ëŠë‚Œ SVG
      return "data:image/svg+xml," + encodeURIComponent(`
        <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 96 96">
          <defs>
            <linearGradient id="g" x1="0" x2="1">
              <stop offset="0" stop-color="${body}" stop-opacity="0.95"/>
              <stop offset="1" stop-color="${accent}" stop-opacity="0.95"/>
            </linearGradient>
            <radialGradient id="c" cx="45%" cy="40%" r="70%">
              <stop offset="0" stop-color="${core}" stop-opacity="0.95"/>
              <stop offset="1" stop-color="${body}" stop-opacity="0.85"/>
            </radialGradient>
          </defs>

          <!-- wing -->
          <path d="M16 54 L42 42 L42 56 L16 64 Z" fill="${wing}" opacity="0.95"/>
          <path d="M80 54 L54 42 L54 56 L80 64 Z" fill="${wing}" opacity="0.95"/>

          <!-- body -->
          <path d="M48 10 L60 36 L60 70 L48 82 L36 70 L36 36 Z" fill="url(#g)" stroke="${core}" stroke-opacity="0.85" stroke-width="3"/>
          <circle cx="48" cy="44" r="10" fill="url(#c)" stroke="${core}" stroke-opacity="0.55" stroke-width="2"/>

          <!-- cockpit -->
          <path d="M48 18 L54 34 L48 38 L42 34 Z" fill="${core}" opacity="0.55"/>

          <!-- flame hint -->
          <path d="M48 86 C54 82 56 78 48 72 C40 78 42 82 48 86 Z" fill="${flame}" opacity="0.92"/>

          <!-- pixel spark -->
          <rect x="26" y="30" width="3" height="3" fill="${core}" opacity="0.65"/>
          <rect x="67" y="31" width="3" height="3" fill="${core}" opacity="0.55"/>
          <rect x="30" y="66" width="3" height="3" fill="${core}" opacity="0.45"/>
        </svg>
      `);
    }

    // tier 0..5 skins
    const JET_SKINS = [
      jetSkinSvg({ body:"#7df9ff", wing:"#ffd166", core:"#ffffff", flame:"#ff6a3d", accent:"#2a55ff" }), // 0
      jetSkinSvg({ body:"#67ff6d", wing:"#eaffff", core:"#ffffff", flame:"#ffd166", accent:"#00c2a8" }), // 10
      jetSkinSvg({ body:"#ffd166", wing:"#7df9ff", core:"#ffffff", flame:"#ff6a3d", accent:"#ff2cc8" }), // 20
      jetSkinSvg({ body:"#ff4dff", wing:"#ffd166", core:"#ffffff", flame:"#7df9ff", accent:"#6b00ff" }), // 30
      jetSkinSvg({ body:"#ff6a3d", wing:"#fff4b3", core:"#ffffff", flame:"#ffd166", accent:"#ff2a2a" }), // 40
      jetSkinSvg({ body:"#ffffff", wing:"#7df9ff", core:"#ffd166", flame:"#ff4dff", accent:"#00ffcc" }), // 50+
    ];

    // ===== í­íƒ„ 8ì¢… =====
    const HAZARD_TYPES = [
      // 0 core
      { key:"core", cls:"", w:36, h:36, hit:0.62, spin:false,
        svg:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Cdefs%3E%3CradialGradient id='g' cx='30%25' cy='25%25' r='70%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff' stop-opacity='.65'/%3E%3Cstop offset='40%25' stop-color='%235b2bbf' stop-opacity='1'/%3E%3Cstop offset='100%25' stop-color='%23210a4f' stop-opacity='1'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='48' cy='48' r='30' fill='url(%23g)' stroke='%23ffffff' stroke-opacity='.9' stroke-width='4'/%3E%3Cpath d='M28 44c10-12 18 12 28 0s18 12 28 0' fill='none' stroke='%237df9ff' stroke-opacity='.65' stroke-width='3'/%3E%3Cpath d='M30 60c12-10 14 10 26 0s16 10 26 0' fill='none' stroke='%23ffd166' stroke-opacity='.45' stroke-width='2.5'/%3E%3C/svg%3E"
      },
      // 1 mine
      { key:"mine", cls:"", w:40, h:40, hit:0.58, spin:false,
        svg:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='110' height='110' viewBox='0 0 110 110'%3E%3Cdefs%3E%3CradialGradient id='m' cx='35%25' cy='30%25' r='70%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff' stop-opacity='.75'/%3E%3Cstop offset='40%25' stop-color='%232aa7ff'/%3E%3Cstop offset='100%25' stop-color='%230b2b66'/%3E%3C/radialGradient%3E%3C/defs%3E%3Cpath d='M55 6l7 18 16-10-6 19 19 2-14 12 16 10-19 1 6 19-16-10-7 18-7-18-16 10 6-19-19-1 16-10-14-12 19-2-6-19 16 10z' fill='%23d7f5ff' opacity='.55'/%3E%3Ccircle cx='55' cy='55' r='28' fill='url(%23m)' stroke='%23ffffff' stroke-opacity='.9' stroke-width='4'/%3E%3Cpath d='M36 60c9-9 15 9 24 0s15 9 24 0' fill='none' stroke='%23ffd166' stroke-opacity='.45' stroke-width='3'/%3E%3C/svg%3E"
      },
      // 2 comet (spin)
      { key:"comet", cls:"spin", w:54, h:22, hit:0.72, spin:true,
        svg:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='80' viewBox='0 0 180 80'%3E%3Cdefs%3E%3ClinearGradient id='c' x1='0' x2='1'%3E%3Cstop offset='0' stop-color='%23ffffff' stop-opacity='0'/%3E%3Cstop offset='.35' stop-color='%23ffd166' stop-opacity='.35'/%3E%3Cstop offset='1' stop-color='%23ff6a3d'/%3E%3C/linearGradient%3E%3CradialGradient id='h' cx='55%25' cy='40%25' r='70%25'%3E%3Cstop offset='0' stop-color='%23ffffff'/%3E%3Cstop offset='.55' stop-color='%23ff6a3d'/%3E%3Cstop offset='1' stop-color='%236a0f1f'/%3E%3C/radialGradient%3E%3C/defs%3E%3Cpath d='M12 40c40-24 74-26 112 0-38 26-72 24-112 0z' fill='url(%23c)'/%3E%3Ccircle cx='136' cy='40' r='22' fill='url(%23h)' stroke='%23ffffff' stroke-opacity='.85' stroke-width='4'/%3E%3C/svg%3E"
      },
      // 3 bigcore
      { key:"bigcore", cls:"", w:58, h:58, hit:0.62, spin:false,
        svg:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'%3E%3Cdefs%3E%3CradialGradient id='b' cx='30%25' cy='25%25' r='70%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff' stop-opacity='.7'/%3E%3Cstop offset='40%25' stop-color='%23ff4dff'/%3E%3Cstop offset='100%25' stop-color='%23210a4f'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='70' cy='74' r='44' fill='url(%23b)' stroke='%23ffffff' stroke-opacity='.9' stroke-width='5'/%3E%3Cpath d='M36 66c12-14 22 14 34 0s22 14 34 0' fill='none' stroke='%237df9ff' stroke-opacity='.65' stroke-width='4'/%3E%3C/svg%3E"
      },
      // 4 plasma (small fast)
      { key:"plasma", cls:"spin", w:26, h:26, hit:0.68, spin:true,
        svg:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Cdefs%3E%3CradialGradient id='p' cx='40%25' cy='35%25' r='70%25'%3E%3Cstop offset='0' stop-color='%23ffffff'/%3E%3Cstop offset='.55' stop-color='%237df9ff'/%3E%3Cstop offset='1' stop-color='%23073a5a'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='48' cy='48' r='22' fill='url(%23p)' stroke='%23ffffff' stroke-opacity='.75' stroke-width='4'/%3E%3Cpath d='M30 50c6-8 12 8 18 0s12 8 18 0' fill='none' stroke='%23ffd166' stroke-opacity='.35' stroke-width='2.5'/%3E%3C/svg%3E"
      },
      // 5 twister (sine weave)
      { key:"twister", cls:"", w:34, h:34, hit:0.62, spin:false,
        svg:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='110' height='110' viewBox='0 0 110 110'%3E%3Cdefs%3E%3CradialGradient id='t' cx='35%25' cy='30%25' r='75%25'%3E%3Cstop offset='0' stop-color='%23ffffff' stop-opacity='.7'/%3E%3Cstop offset='.55' stop-color='%23ffd166'/%3E%3Cstop offset='1' stop-color='%235b2bbf'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='55' cy='55' r='26' fill='url(%23t)' stroke='%23ffffff' stroke-opacity='.85' stroke-width='4'/%3E%3Cpath d='M30 55c8-10 14 10 22 0s14 10 22 0' fill='none' stroke='%237df9ff' stroke-opacity='.55' stroke-width='3'/%3E%3C/svg%3E"
      },
      // 6 splitter (mid split)
      { key:"splitter", cls:"", w:42, h:42, hit:0.60, spin:false,
        svg:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Cdefs%3E%3CradialGradient id='s' cx='35%25' cy='30%25' r='75%25'%3E%3Cstop offset='0' stop-color='%23ffffff' stop-opacity='.75'/%3E%3Cstop offset='.55' stop-color='%23ff4dff'/%3E%3Cstop offset='1' stop-color='%230b2b66'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='60' cy='60' r='30' fill='url(%23s)' stroke='%23ffffff' stroke-opacity='.85' stroke-width='4'/%3E%3Cpath d='M60 30v60' stroke='%23ffd166' stroke-opacity='.75' stroke-width='5'/%3E%3Cpath d='M38 60h44' stroke='%237df9ff' stroke-opacity='.55' stroke-width='4'/%3E%3C/svg%3E"
      },
      // 7 seeker (slight homing)
      { key:"seeker", cls:"spin", w:32, h:32, hit:0.64, spin:true,
        svg:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Cdefs%3E%3CradialGradient id='q' cx='35%25' cy='30%25' r='75%25'%3E%3Cstop offset='0' stop-color='%23ffffff' stop-opacity='.75'/%3E%3Cstop offset='.55' stop-color='%2367ff6d'/%3E%3Cstop offset='1' stop-color='%23073a5a'/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='48' cy='48' r='24' fill='url(%23q)' stroke='%23ffffff' stroke-opacity='.85' stroke-width='4'/%3E%3Cpath d='M48 20l6 10-6 4-6-4z' fill='%23ffffff' opacity='.55'/%3E%3Cpath d='M30 58c10-8 12 8 18 0s12 8 18 0' fill='none' stroke='%23ffd166' stroke-opacity='.45' stroke-width='3'/%3E%3C/svg%3E"
      }
    ];

    const STAR_SVG =
      "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Cdefs%3E%3CradialGradient id='s' cx='50%25' cy='35%25' r='70%25'%3E%3Cstop offset='0%25' stop-color='%23fff4b3'/%3E%3Cstop offset='55%25' stop-color='%23ffd166'/%3E%3Cstop offset='100%25' stop-color='%23ff9a3c'/%3E%3C/radialGradient%3E%3C/defs%3E%3Cpath d='M48 6l11 24 26 3-19 18 5 26-23-13-23 13 5-26L11 33l26-3z' fill='url(%23s)' stroke='%23ffffff' stroke-opacity='.85' stroke-width='3'/%3E%3C/svg%3E";

    // ===== HITBOX =====
    const PLAYER_HIT_SCALE = 0.82;
    const STAR_HIT_SCALE   = 0.85;

    // ===== AUDIO =====
    let audioCtx = null;
    let audioReady = null;

    function ensureAudioReady(){
      if (!audioReady) audioReady = initAudio();
      return audioReady;
    }
    async function initAudio(){
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state !== "running") {
        try { await audioCtx.resume(); } catch(e) {}
      }
    }
    function beep({ freq=440, dur=0.08, type="square", vol=0.18, endFreq=null } = {}){
      if (!audioCtx || audioCtx.state !== "running") return;
      const t = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = type;
      osc.frequency.setValueAtTime(freq, t);
      if (endFreq != null) osc.frequency.exponentialRampToValueAtTime(Math.max(40, endFreq), t + dur);

      gain.gain.setValueAtTime(0.0001, t);
      gain.gain.exponentialRampToValueAtTime(vol, t + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, t + dur);

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start(t);
      osc.stop(t + dur + 0.02);
    }
    function sfxStart(){
      ensureAudioReady().then(() => {
        beep({ freq: 523, dur: 0.06, type:"square", vol:0.12 });
        setTimeout(() => beep({ freq: 659, dur: 0.07, type:"square", vol:0.12 }), 70);
      }).catch(()=>{});
    }
    function sfxCoin(){
      ensureAudioReady().then(() => {
        beep({ freq: 880, dur: 0.05, type:"triangle", vol:0.10, endFreq: 1200 });
      }).catch(()=>{});
    }
    function sfxOver(){
      ensureAudioReady().then(() => {
        beep({ freq: 140, dur: 0.10, type:"square",  vol:0.28, endFreq: 70 });
        setTimeout(() => beep({ freq: 90, dur: 0.12, type:"sawtooth", vol:0.22, endFreq: 40 }), 70);
      }).catch(()=>{});
    }
    function sfxBuy(){
      ensureAudioReady().then(() => {
        beep({ freq: 988, dur: 0.05, type:"triangle", vol:0.10 });
        setTimeout(() => beep({ freq: 1319, dur: 0.06, type:"triangle", vol:0.10 }), 70);
      }).catch(()=>{});
    }

    // ===== GAME STATE =====
    let running = false;
    let raf = null;
    let lastTime = 0;
    let startAt = 0;

    const isMobile = matchMedia("(max-width: 600px)").matches;
    const pSize = isMobile ? 62 : 56;

    const modes = [
      { name:"EASY", hazardRate: 520, hazardSpeed: 250, starRate: 980, starSpeed: 165, zigzag:false },
      { name:"HARD", hazardRate: 360, hazardSpeed: 330, starRate: 1150, starSpeed: 195, zigzag:true }
    ];
    let modeIdx = 0;

    let gW = 0, gH = 0;
    let px = 0, py = 0;
    let lastPx = 0;

    let scorePoints = 0;
    let level = 0; // âœ… SHOPì—ì„œ ê³ ì •ë˜ëŠ” ë ˆë²¨(0~100)

    // ===== Economy (STAR bank + upgrades) =====
    const LS_BANK = "xgp_bank_v1";
    const LS_UPG  = "xgp_upgrade_v1";
    const LS_BEST = "xgp_best_v6";

    function loadBank(){
      const v = localStorage.getItem(LS_BANK);
      if (v == null){
        localStorage.setItem(LS_BANK, String(10000));
        return 10000;
      }
      const n = Number(v);
      return Number.isFinite(n) ? Math.max(0, Math.floor(n)) : 10000;
    }
    function loadUpg(){
      const v = localStorage.getItem(LS_UPG);
      const n = Number(v ?? 0);
      return Number.isFinite(n) ? Math.max(0, Math.min(100, Math.floor(n))) : 0;
    }
    function saveBank(n){ localStorage.setItem(LS_BANK, String(Math.max(0, Math.floor(n)))); }
    function saveUpg(n){ localStorage.setItem(LS_UPG, String(Math.max(0, Math.min(100, Math.floor(n))))); }

    let bank = loadBank();
    let upgrades = loadUpg(); // upgrades == level
    level = upgrades;

    let best = Number(localStorage.getItem(LS_BEST) || 0);
    bestEl.textContent = best;

    const hazards = [];
    const stars = [];

    let hazardTimer = null;
    let starTimer = null;

    function measureGame(){
      const r = game.getBoundingClientRect();
      gW = r.width;
      gH = r.height;
    }
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    // ===== Tier visuals (ë ˆë²¨ 10ë‹¨ìœ„) =====
    const JET_TIERS = [
      { auraHue:"190deg", auraA:0.18, auraB:0.08, ringHue:"190deg", ringA:0.18, trailHue:"190deg", trailA:0.55, particleRate: 90, filter:"saturate(1.1) contrast(1.05) brightness(1.05)"},
      { auraHue:"70deg",  auraA:0.30, auraB:0.14, ringHue:"70deg",  ringA:0.26, trailHue:"70deg",  trailA:0.70, particleRate: 65, filter:"saturate(2.4) contrast(1.25) brightness(1.12)"},
      { auraHue:"160deg", auraA:0.36, auraB:0.18, ringHue:"160deg", ringA:0.30, trailHue:"160deg", trailA:0.82, particleRate: 55, filter:"saturate(2.9) contrast(1.35) brightness(1.18)"},
      { auraHue:"255deg", auraA:0.42, auraB:0.22, ringHue:"255deg", ringA:0.34, trailHue:"255deg", trailA:0.92, particleRate: 45, filter:"saturate(3.3) contrast(1.45) brightness(1.22)"},
      { auraHue:"330deg", auraA:0.48, auraB:0.26, ringHue:"330deg", ringA:0.38, trailHue:"330deg", trailA:1.00, particleRate: 38, filter:"saturate(3.8) contrast(1.55) brightness(1.25)"},
      { auraHue:"120deg", auraA:0.55, auraB:0.30, ringHue:"120deg", ringA:0.44, trailHue:"120deg", trailA:1.10, particleRate: 32, filter:"saturate(4.2) contrast(1.65) brightness(1.30)"}
    ];

    let lastTier = -1;

    function currentTier(){
      const t = Math.floor(level / 10);
      return clamp(t, 0, JET_TIERS.length - 1);
    }
    function tierSkinIndex(){
      // ìŠ¤í‚¨ì€ 0~5ê¹Œì§€ë§Œ ì¤€ë¹„í–ˆì§€ë§Œ 60~100ë„ 5ë²ˆ ìŠ¤í‚¨ ê³„ì†
      const t = Math.floor(level / 10);
      return clamp(t, 0, JET_SKINS.length - 1);
    }

    function spawnTierRing(){
      const r = document.createElement("div");
      r.className = "tierRing";
      r.style.left = Math.round(px + pSize/2) + "px";
      r.style.top  = Math.round(py + pSize/2) + "px";
      game.appendChild(r);
      setTimeout(()=> r.remove(), 620);
    }

    function applyJetTier(force=false){
      const t = currentTier();
      if (!force && t === lastTier) return;
      lastTier = t;

      const conf = JET_TIERS[t];

      // VFX vars
      document.documentElement.style.setProperty("--jetAuraHue", conf.auraHue);
      document.documentElement.style.setProperty("--jetAuraA", String(conf.auraA));
      document.documentElement.style.setProperty("--jetAuraB", String(conf.auraB));
      document.documentElement.style.setProperty("--jetRingHue", conf.ringHue);
      document.documentElement.style.setProperty("--jetRingA", String(conf.ringA));
      document.documentElement.style.setProperty("--trailHue", conf.trailHue);
      document.documentElement.style.setProperty("--trailA", String(conf.trailA));

      // âœ… ìŠ¤í‚¨ â€œì´ë¯¸ì§€ ìì²´ ë³€ê²½â€
      jetSprite.style.backgroundImage = `url("${JET_SKINS[tierSkinIndex()]}")`;

      // ì‚´ì§ ì¶”ê°€ í•„í„°ë¡œ â€œí™•â€ ëŠë‚Œ
      jetSprite.style.filter = conf.filter + " drop-shadow(0 0 14px rgba(125,249,255,.22))";

      // ê°•ì œ ëŠë‚Œ: ìŠ¤í‚¨ ë°”ë€” ë•Œ ì•„ì£¼ ì‚´ì§ íŒí•‘
      jetSprite.style.transform = "scale(1.06)";
      setTimeout(()=> { jetSprite.style.transform = "scale(1.0)"; }, 120);
    }

    function gainMultiplier(){
      // ë ˆë²¨ì— ë§ëŠ” ì ìˆ˜ ë°°ìˆ˜ (ì›ë˜ì²˜ëŸ¼ 1.05^level)
      return Math.pow(1.05, level);
    }

    function setPlayerX(x){
      px = clamp(Math.round(x), 0, Math.round(gW - pSize));
      const dx = px - lastPx;
      lastPx = px;
      const tilt = clamp(dx * 0.55, -14, 14);
      player.style.transform = `translate3d(${px}px, ${py}px, 0) rotate(${tilt}deg)`;
    }

    function positionPlayer(){
      py = Math.round(gH * 0.74);
      player.style.width = pSize + "px";
      player.style.height = pSize + "px";
      player.style.transform = `translate3d(${px}px, ${py}px, 0) rotate(0deg)`;
      lastPx = px;
    }

    function showTouchHint(show){
      touchHint.style.display = show ? "block" : "none";
      if (!show) return;
      touchHint.style.left = Math.round(px + pSize/2) + "px";
      touchHint.style.top  = Math.round(py + pSize + 8) + "px";
    }

    function popText(x, y, text){
      const el = document.createElement("div");
      el.className = "pop";
      el.textContent = text;
      el.style.left = Math.round(x) + "px";
      el.style.top = Math.round(y) + "px";
      game.appendChild(el);
      setTimeout(()=> el.remove(), 750);
    }

    function spawnExplosion(x, y){
      const ex = document.createElement("div");
      ex.className = "explosion";
      ex.style.left = Math.round(x) + "px";
      ex.style.top  = Math.round(y) + "px";
      game.appendChild(ex);
      setTimeout(() => ex.remove(), 520);
    }

    function aabbScaled(ax, ay, aw, ah, as, bx, by, bw, bh, bs){
      const aW = aw * as, aH = ah * as;
      const bW = bw * bs, bH = bh * bs;

      const aX = ax + (aw - aW)/2;
      const aY = ay + (ah - aH)/2;

      const bX = bx + (bw - bW)/2;
      const bY = by + (bh - bH)/2;

      return !(aX + aW < bX || aX > bX + bW || aY + aH < bY || aY > bY + bH);
    }

    // ===== Spawning logic =====
    function pickHazardType(){
      const t = currentTier();
      const r = Math.random();

      // í‹°ì–´ê°€ ë†’ì„ìˆ˜ë¡ â€œíŠ¹ìˆ˜ íƒ€ì…â€ ì¶œí˜„ ë¹„ìœ¨ ì¦ê°€
      // 0: core/mine ì¤‘ì‹¬, 1~: comet/plasma/twister/splitter/seeker ì¦ê°€
      const weightsByTier = [
        // [core, mine, comet, bigcore, plasma, twister, splitter, seeker]
        [0.40, 0.22, 0.10, 0.08, 0.08, 0.06, 0.04, 0.02], // t0
        [0.30, 0.18, 0.12, 0.10, 0.10, 0.08, 0.07, 0.05], // t1
        [0.22, 0.14, 0.14, 0.12, 0.12, 0.10, 0.09, 0.07], // t2
        [0.18, 0.12, 0.15, 0.13, 0.13, 0.11, 0.10, 0.08], // t3
        [0.14, 0.10, 0.16, 0.14, 0.14, 0.12, 0.11, 0.09], // t4+
      ];
      const w = weightsByTier[Math.min(t, weightsByTier.length - 1)];

      let acc = 0;
      for (let i=0;i<w.length;i++){
        acc += w[i];
        if (r <= acc) return HAZARD_TYPES[i];
      }
      return HAZARD_TYPES[0];
    }

    function spawnHazard(){
      const type = pickHazardType();

      const el = document.createElement("div");
      el.className = "hazard " + (type.cls || "");
      el.style.width = type.w + "px";
      el.style.height = type.h + "px";
      el.style.backgroundImage = `url("${type.svg}")`;

      const x = Math.random() * (gW - type.w);
      const y = -160;

      const m = modes[modeIdx];
      const zig = m.zigzag;

      // vx: zigzag ê¸°ë³¸, comet/seekerëŠ” ë” ê°•í•˜ê±°ë‚˜ íŠ¹ìˆ˜
      let vx = 0;
      if (zig) vx = (Math.random() < 0.5 ? -1 : 1) * (70 + Math.random()*120);

      if (type.key === "comet") vx = (Math.random() < 0.5 ? -1 : 1) * (140 + Math.random()*180);
      if (type.key === "plasma") vx = (Math.random() < 0.5 ? -1 : 1) * (90 + Math.random()*140);
      if (type.key === "twister") vx = (Math.random() < 0.5 ? -1 : 1) * (40 + Math.random()*60);

      const speedMul =
        (type.key === "bigcore") ? 0.92 :
        (type.key === "plasma") ? 1.20 :
        (type.key === "comet") ? 1.08 :
        1.00;

      // splitter: ë¶„ì—´ íŠ¸ë¦¬ê±°
      const splitAt = (type.key === "splitter") ? (gH * (0.35 + Math.random()*0.25)) : null;

      const obj = {
        el, x, y, vx,
        w:type.w, h:type.h,
        hitScale: type.hit,
        speedMul,
        key:type.key,
        splitAt,
        didSplit:false,
        phase: Math.random()*Math.PI*2
      };
      hazards.push(obj);

      el.style.setProperty("--x", x + "px");
      el.style.setProperty("--y", y + "px");
      game.appendChild(el);
    }

    function spawnMini(x, y, dir){
      // splitter ë¶„ì—´ìš© ë¯¸ë‹ˆ(í”Œë¼ì¦ˆë§ˆ ëŠë‚Œ)
      const type = HAZARD_TYPES[4];
      const el = document.createElement("div");
      el.className = "hazard spin";
      el.style.width = type.w + "px";
      el.style.height = type.h + "px";
      el.style.backgroundImage = `url("${type.svg}")`;

      const obj = {
        el,
        x: clamp(x, 0, gW - type.w),
        y,
        vx: dir * (160 + Math.random()*140),
        w:type.w, h:type.h,
        hitScale: 0.70,
        speedMul: 1.15,
        key:"mini",
        splitAt:null,
        didSplit:true,
        phase: Math.random()*Math.PI*2
      };
      hazards.push(obj);

      el.style.setProperty("--x", obj.x + "px");
      el.style.setProperty("--y", obj.y + "px");
      game.appendChild(el);
    }

    function spawnStar(){
      const el = document.createElement("div");
      el.className = "star";
      el.style.backgroundImage = `url("${STAR_SVG}")`;

      const x = Math.random() * (gW - 28);
      const y = -100;

      const obj = { el, x, y, w:28, h:28 };
      stars.push(obj);

      el.style.setProperty("--x", x + "px");
      el.style.setProperty("--y", y + "px");
      game.appendChild(el);
    }

    function clearObjects(){
      for (const o of hazards) o.el.remove();
      for (const o of stars) o.el.remove();
      hazards.length = 0;
      stars.length = 0;
      [...game.querySelectorAll(".pop,.explosion,.jetParticle,.tierRing")].forEach(el => el.remove());
    }

    function stop(){
      running = false;
      if (raf) cancelAnimationFrame(raf);
      raf = null;
      if (hazardTimer){ clearInterval(hazardTimer); hazardTimer = null; }
      if (starTimer){ clearInterval(starTimer); starTimer = null; }
    }

    function showOverlay(){ overlay.style.display = "flex"; }
    function hideOverlay(){ overlay.style.display = "none"; }

    function syncHud(){
      levelEl.textContent = String(level);
      bankEl.textContent = String(bank);
      shopBankEl.textContent = String(bank);
      shopLevelEl.textContent = String(level);
    }

    function resetRun(){
      stop();
      measureGame();
      clearObjects();

      scorePoints = 0;
      scoreEl.textContent = "0";
      timeEl.textContent = "0.0";

      px = Math.round(gW/2 - pSize/2);
      positionPlayer();
      showTouchHint(true);

      // ë ˆë²¨/ìŠ¤í‚¨ì€ SHOP ìƒíƒœ ìœ ì§€
      lastTier = -1;
      applyJetTier(true);

      showOverlay();
    }

    function startGame(){
      // SHOP ë ˆë²¨ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
      hideOverlay();
      showTouchHint(false);

      running = true;
      startAt = performance.now();
      lastTime = startAt;

      const m = modes[modeIdx];
      hazardTimer = setInterval(spawnHazard, m.hazardRate);
      starTimer = setInterval(spawnStar, m.starRate);

      raf = requestAnimationFrame(tick);
    }

    function gameOver(){
      if (!running) return;
      stop();
      sfxOver();

      const lived = (performance.now() - startAt) / 1000;
      const final = Math.floor(scorePoints * 10 + lived * 5);

      if (final > best) {
        best = final;
        localStorage.setItem(LS_BEST, String(best));
        bestEl.textContent = best;
      }

      game.classList.remove("shake");
      void game.offsetWidth;
      game.classList.add("shake");

      showOverlay();
      showTouchHint(true);
    }

    // ===== Jet particles =====
    let particleAcc = 0;
    function spawnJetParticle(){
      const jp = document.createElement("div");
      jp.className = "jetParticle";

      const x = px + pSize/2 - 3;
      const y = py + pSize - 6;

      const dx = (Math.random()*16 - 8).toFixed(1) + "px";
      const dy = (18 + Math.random()*18).toFixed(1) + "px";

      jp.style.setProperty("--x", Math.round(x) + "px");
      jp.style.setProperty("--y", Math.round(y) + "px");
      jp.style.setProperty("--dx", dx);
      jp.style.setProperty("--dy", dy);

      const t = currentTier();
      const size = 5 + t * 1.3 + Math.random()*2.0;
      jp.style.width = size.toFixed(1) + "px";
      jp.style.height = size.toFixed(1) + "px";

      game.appendChild(jp);
      setTimeout(()=> jp.remove(), 620);
    }

    function tick(now){
      if (!running) return;
      const dt = Math.min(0.033, (now - lastTime) / 1000);
      lastTime = now;

      const lived = (now - startAt) / 1000;
      timeEl.textContent = lived.toFixed(1);

      // ì‹œê°„ì— ë”°ë¥¸ ì†ë„ ìƒìŠ¹
      const progress = Math.min(Math.max((lived - 10) / 110, 0), 1);
      const speedMultiplier = 1 + progress;
      const m = modes[modeIdx];

      // particles
      const conf = JET_TIERS[currentTier()];
      particleAcc += dt * 1000;
      while (particleAcc >= conf.particleRate){
        particleAcc -= conf.particleRate;
        spawnJetParticle();
      }

      // hazards update
      for (let i = hazards.length - 1; i >= 0; i--){
        const h = hazards[i];
        const spd = m.hazardSpeed * h.speedMul * speedMultiplier;
        h.y += spd * dt;

        // movement variations
        if (m.zigzag || h.key === "comet" || h.key === "plasma" || h.key === "mini"){
          h.x += h.vx * dt * (0.85 + progress*0.75);
        }

        // twister: sine weave even on EASY
        if (h.key === "twister"){
          h.phase += dt * (3.0 + progress*2.0);
          h.x += Math.sin(h.phase) * (55 + progress*40) * dt;
        }

        // seeker: slight homing
        if (h.key === "seeker"){
          const targetX = px + pSize/2 - h.w/2;
          h.vx += (targetX - h.x) * dt * 1.5; // gentle acceleration
          h.vx = clamp(h.vx, -260, 260);
          h.x += h.vx * dt;
        }

        // bounds bounce (for those with vx)
        const minX = 0;
        const maxX = gW - h.w;
        if (h.x <= minX){ h.x = minX; h.vx = Math.abs(h.vx); }
        if (h.x >= maxX){ h.x = maxX; h.vx = -Math.abs(h.vx); }

        // splitter mid split
        if (h.key === "splitter" && !h.didSplit && h.splitAt != null && h.y >= h.splitAt){
          h.didSplit = true;
          // ë¶„ì—´ ì´í™íŠ¸
          spawnTierRing();
          spawnMini(h.x - 8, h.y + 8, -1);
          spawnMini(h.x + 8, h.y + 8,  1);
        }

        if (h.y > gH + 200){
          h.el.remove();
          hazards.splice(i, 1);
          continue;
        }

        h.el.style.setProperty("--x", h.x + "px");
        h.el.style.setProperty("--y", h.y + "px");

        if (aabbScaled(px, py, pSize, pSize, PLAYER_HIT_SCALE, h.x, h.y, h.w, h.h, h.hitScale)){
          spawnExplosion(h.x + h.w/2, h.y + h.h/2);
          gameOver();
          return;
        }
      }

      // stars update
      for (let i = stars.length - 1; i >= 0; i--){
        const s = stars[i];
        s.y += m.starSpeed * (speedMultiplier * 1.45) * dt;

        if (s.y > gH + 160){
          s.el.remove();
          stars.splice(i, 1);
          continue;
        }

        s.el.style.setProperty("--x", s.x + "px");
        s.el.style.setProperty("--y", s.y + "px");

        if (aabbScaled(px, py, pSize, pSize, PLAYER_HIT_SCALE, s.x, s.y, s.w, s.h, STAR_HIT_SCALE)){
          sfxCoin();
          s.el.remove();
          stars.splice(i, 1);

          // âœ… ë ˆë²¨ ê³ ì •: ì ìˆ˜ë§Œ ë ˆë²¨ ë°°ìˆ˜ë¡œ ì¦ê°€
          const gain = gainMultiplier();
          scorePoints += gain;

          scoreEl.textContent = (scorePoints >= 1000)
            ? scorePoints.toFixed(0)
            : scorePoints.toFixed(1);

          popText(px + 4, py - 10, "+" + (gain >= 10 ? gain.toFixed(1) : gain.toFixed(2)));
        }
      }

      raf = requestAnimationFrame(tick);
    }

    // ===== INPUT =====
    const keyState = { left:false, right:false };
    function moveBy(dx){ setPlayerX(px + dx); }

    window.addEventListener("keydown", (e) => {
      const k = e.key.toLowerCase();
      if (e.key === "ArrowLeft" || k === "a") keyState.left = true;
      if (e.key === "ArrowRight" || k === "d") keyState.right = true;
    });
    window.addEventListener("keyup", (e) => {
      const k = e.key.toLowerCase();
      if (e.key === "ArrowLeft" || k === "a") keyState.left = false;
      if (e.key === "ArrowRight" || k === "d") keyState.right = false;
    });

    function controlLoop(){
      const speed = isMobile ? 7 : 6;
      if (keyState.left) moveBy(-speed);
      if (keyState.right) moveBy(speed);
      requestAnimationFrame(controlLoop);
    }
    requestAnimationFrame(controlLoop);

    let dragging = false;
    function pointerX(e){
      const rect = game.getBoundingClientRect();
      const clientX = (e.touches ? e.touches[0].clientX : e.clientX);
      let x = clientX - rect.left;
      if (e.touches) x -= 28;
      return x - pSize/2;
    }
    game.addEventListener("mousedown", (e)=>{ dragging = true; setPlayerX(pointerX(e)); });
    window.addEventListener("mousemove", (e)=>{ if(dragging) setPlayerX(pointerX(e)); });
    window.addEventListener("mouseup", ()=> dragging = false);

    game.addEventListener("touchstart", (e)=>{ dragging = true; setPlayerX(pointerX(e)); }, {passive:false});
    game.addEventListener("touchmove", (e)=>{ if(dragging) setPlayerX(pointerX(e)); }, {passive:false});
    game.addEventListener("touchend", ()=> dragging = false);

    // ===== SHOP actions =====
    function canBuy(n){
      if (n <= 0) return false;
      const cost = 100 * n;
      if (level + n > 100) return false;
      if (bank < cost) return false;
      return true;
    }

    function buy(n){
      if (!canBuy(n)){
        popText(px + pSize/2 - 30, py - 20, "NO STAR!");
        return;
      }
      const cost = 100 * n;
      bank -= cost;
      level += n;

      saveBank(bank);
      saveUpg(level);
      syncHud();

      // ìŠ¤í‚¨ ì¦‰ì‹œ ê°±ì‹ 
      lastTier = -1;
      applyJetTier(true);
      spawnTierRing();
      sfxBuy();
    }

    buy1Btn.addEventListener("click", ()=> buy(1));
    buy10Btn.addEventListener("click", ()=> buy(10));
    buyMaxBtn.addEventListener("click", ()=>{
      const maxByLevel = 100 - level;
      const maxByBank = Math.floor(bank / 100);
      const n = Math.max(0, Math.min(maxByLevel, maxByBank));
      if (n <= 0){
        popText(px + pSize/2 - 26, py - 20, "NOPE!");
        return;
      }
      buy(n);
    });

    resetShopBtn.addEventListener("click", ()=>{
      // ì™„ì „ ì´ˆê¸°í™”: STAR=10,000, ë ˆë²¨=0
      bank = 10000;
      level = 0;
      saveBank(bank);
      saveUpg(level);
      syncHud();

      lastTier = -1;
      applyJetTier(true);
      spawnTierRing();
      popText(px + pSize/2 - 42, py - 20, "RESET!");
    });

    // ===== Buttons =====
    startBtn.addEventListener("click", () => {
      ensureAudioReady().then(() => { sfxStart(); startGame(); }).catch(() => startGame());
    });
    restartBtn.addEventListener("click", () => resetRun());
    hardBtn.addEventListener("click", () => {
      modeIdx = (modeIdx + 1) % modes.length;
      hardBtn.textContent = "ë‚œì´ë„: " + modes[modeIdx].name;
      resetRun();
    });

    window.addEventListener("resize", () => {
      measureGame();
      px = clamp(px, 0, gW - pSize);
      positionPlayer();
      showTouchHint(!running);
    });

    // ===== init =====
    (function init(){
      startBg.style.backgroundImage = `url("${START_SCREEN_URL}")`;

      measureGame();
      px = Math.round(gW/2 - pSize/2);
      positionPlayer();

      // apply stored economy
      bank = loadBank();
      level = loadUpg();
      syncHud();

      lastTier = -1;
      applyJetTier(true);

      showTouchHint(true);
      showOverlay();
    })();
  </script>
</body>
</html>
